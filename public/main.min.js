function htmlEncode(e){return el=document.createElement("div"),el.innerText=el.textContent=e,e=el.innerHTML}var socket,ww=3000,wh=3000,mms=100,player={id:0,x:ww/2,y:wh/2,tx:ww/2,ty:wh/2,points:0,score:0},players=[],leader={x:0,y:0},perm={},bullets=[],ast=[],canvas=document.getElementById("canvas"),game=canvas.getContext("2d"),w,h,gridWidth=30,slw=10,name,cls=0,ability=0,rotation=0,ready=0,spectating=0,shipsDestroyed=0,timeStarted,topPosition=10,shaking=0,shakeAmount=0,shakeX=0,shakeY=0,spaceJustDown=0,auto=0,justSent=0,blocker=0,loadingText=document.getElementById("loading"),menuElement=document.getElementById("menu"),menuContainer=document.getElementById("mcontainer"),logoElement=document.getElementById("logo"),profilesElement=document.getElementById("profiles"),mainContainer=document.getElementById("main"),connectingStatus=document.getElementById("connecting"),playButton=document.getElementById("play"),spectateButton=document.getElementById("spectate"),aliasBox=document.getElementById("alias"),classBox=document.getElementById("class"),statsContainer=document.getElementById("stats");statsContainer.style.display="none";var statsHeading=document.getElementById("sheading"),statElements=document.getElementsByClassName("stat"),statsTwitter=document.getElementById("sstwitter"),continueButton=document.getElementById("continue"),abilityBox=document.getElementById("ability"),abilityStatus=document.getElementById("astatus"),abilityNameElement=document.getElementById("aname"),abilityFill=document.getElementById("afill"),myShipHeading=document.getElementById("msheading"),myShipClass=document.getElementById("msclass"),myShipAbility=document.getElementById("msability"),myShipStats=document.getElementById("msstats"),myShipDescription=document.getElementById("msdescription"),shareHeading=document.getElementById("siheading"),shareText=document.getElementById("sitext"),shareButtons=document.getElementsByClassName("unlocker"),tipsElement=document.getElementById("tips"),otherCards=document.getElementsByClassName("other"),hudElement=document.getElementById("hud"),escTip=document.getElementById("esctip"),pointsBox=document.getElementById("points"),boardElement=document.getElementById("board"),upgradesContainer=document.getElementById("upgrades"),upgradeElements=[],minimapElement=document.getElementById("minimap"),mini=minimapElement.getContext("2d");minimapElement.width=mms,minimapElement.height=mms;var chatInput=document.getElementById("cinput"),chatMessages=document.getElementById("cmessages"),bigNotification=document.getElementById("bnotification"),bottomAd=document.getElementById("bad"),cpx=ww/2,cpy=wh/2,dss=1500,cs=1,upgradeMult=10,resize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,w=canvas.width,h=canvas.height,w>h?rr=w/dss:rr=h/dss,cs=rr,slw=10*cs,menuContainer.style.transform="translateY(-50%) scale("+cs/1.4+")",bottomAd.style.transform="translateX(-50%) scale("+cs/1.4+")"};window.onresize=resize,resize();var clientLast=Date.now(),serverLast=1,serverDelta=1,servers=["162.243.149.205"],serverFound=0,csr,classes=[{width:60,height:80,c1:"#1a1aff",c2:"#0000e6"},{width:70,height:90,c1:"#e60000",c2:"#b30000"},{width:60,height:90,c1:"#cc00cc",c2:"#990099"},{width:60,height:80,c1:"#00e600",c2:"#00b300"},{width:90,height:80,c1:"#999999",c2:"#737373"},{width:60,height:90,c1:"#e6c300",c2:"#b39800"}],menuClasses=[{name:"Fighter",stats:[3,3,2,2,3]},{name:"Tanky",stats:[5,1,3,4,3]},{name:"Striker",stats:[2,2,3,3,4]},{name:"Speedy",stats:[1,5,2,1,4]},{name:"Destroyer",stats:[3,2,4,5,1]},{name:"Hoarder",stats:[2,2,2,4,2]}],menuClassesStats=["Health","Speed","Damage","Weight","Range"],abilityNames=["Repair","Super Boost","Shield","Invisibility"],upgrades=[{name:"Maximum Health",level:1},{name:"Health Regeneration",level:1},{name:"Boost Power",level:1},{name:"Reload Speed",level:1},{name:"Bullet Damage",level:1},{name:"Bullet Range",level:1},{name:"Bullet Speed",level:1},{name:"Collision Damage",level:1},{name:"Ability",level:1}],afp=function(e,t,n,a){return Math.atan2(a-t,n-e)},pfa=function(e,t,n,a){return[Math.cos(n)*a+e,Math.sin(n)*a+t]},dfp=function(e,t,n,a){return Math.sqrt((e-n)*(e-n)+(t-a)*(t-a))},lerp=function(e,t,n){return e+n*(t-e)},lerpxy=function(e,t,n,a,i){return[e+i*(n-e),t+i*(a-t)]},random=function(e){return Math.floor(Math.random()*e)},cx=function(e){return(e-cpx)*cs+w/2-classes[cls].width/2*cs+shakeX},cy=function(e){return(e-cpy)*cs+h/2-classes[cls].height/2*cs+shakeY},shake=function(e,t){shaking=1,shakeAmount=t,setTimeout(stopShake,e)},stopShake=function(){shaking=0},updateShake=function(){shakeX=lerp(shakeX,random(2*shakeAmount)-shakeAmount,.5),shakeY=lerp(shakeY,random(2*shakeAmount)-shakeAmount,.5)},updateCamera=function(e){li=lerpxy(cpx,cpy,player.x,player.y,e),cpx=li[0],cpy=li[1]},tsc=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},checkCollision=function(e,t,n,a,i,s){return dfp(e,t,a,i)<n+s},unlockClass=function(e){shareHeading.innerHTML="Class unlocked",shareText.innerHTML="Hoarder unlocked: get 20% off upgrades!",classBox.innerHTML+='<option value="5">Hoarder</option>',classBox.value=String(cls),e&&(localStorage.unlocked="1",classBox.value="5",cls=5)},shapes=[function(e,t,n){game.moveTo(0,-t/2),game.lineTo(-e/2,t/2),game.lineTo(e/2,t/2),game.lineTo(0,-t/2),game.fill(),drawLine(0,-t/2,-e/2,t/2,n,slw,"round"),drawLine(-e/2,t/2,e/2,t/2,n,slw,"round"),drawLine(e/2,t/2,0,-t/2,n,slw,"round")},function(e,t,n){game.moveTo(-e/4,-t/2),game.lineTo(-e/2,t/2),game.lineTo(e/2,t/2),game.lineTo(e/4,-t/2),game.fill(),drawLine(-e/4,-t/2,-e/2,t/2,n,slw,"round"),drawLine(-e/2,t/2,e/2,t/2,n,slw,"round"),drawLine(e/2,t/2,e/4,-t/2,n,slw,"round"),drawLine(-e/4,-t/2,e/4,-t/2,n,slw,"round")},function(e,t,n){game.moveTo(0,-t/2),game.lineTo(e/2,0),game.lineTo(e/2,t/2),game.quadraticCurveTo(0,0,-e/2,t/2),game.lineTo(-e/2,0),game.fill(),drawLine(0,-t/2,e/2,0,n,slw,"round"),drawLine(0,-t/2,-e/2,0,n,slw,"round"),drawLine(e/2,0,e/2,t/2,n,slw,"round"),drawLine(-e/2,0,-e/2,t/2,n,slw,"round"),drawCurve(-e/2,t/2,e/2,t/2,0,0,n,slw,"round")},function(e,t,n){game.moveTo(0,-t/2),game.lineTo(e/2,t/2),game.lineTo(0,t/4),game.lineTo(-e/2,t/2),game.lineTo(0,-t/2),game.fill(),drawLine(0,-t/2,e/2,t/2,n,slw,"round"),drawLine(e/2,t/2,0,t/4,n,slw,"round"),drawLine(0,t/4,-e/2,t/2,n,slw,"round"),drawLine(-e/2,t/2,0,-t/2,n,slw,"round")},function(e,t,n){game.moveTo(e/4,-t/2),game.lineTo(e/2,t/2),game.quadraticCurveTo(e/4,t/4,0,t/2),game.quadraticCurveTo(-e/4,t/4,-e/2,t/2),game.lineTo(-e/4,-t/2),game.quadraticCurveTo(0,-t/1.5,e/4,-t/2),game.fill(),drawLine(e/4,-t/2,e/2,t/2,n,slw,"round"),drawCurve(e/2,t/2,0,t/2,e/4,t/4,n,slw,"round"),drawCurve(0,t/2,-e/2,t/2,-e/4,t/4,n,slw,"round"),drawLine(-e/2,t/2,-e/4,-t/2,n,slw,"round"),drawCurve(-e/4,-t/2,e/4,-t/2,0,-t/1.5,n,slw,"round")},function(e,t,n){game.moveTo(0,-t/2),game.lineTo(e/2,0),game.lineTo(e/2,t/2),game.lineTo(-e/2,t/2),game.lineTo(-e/2,0),game.fill(),drawLine(0,-t/2,e/2,0,n,slw,"round"),drawLine(0,-t/2,-e/2,0,n,slw,"round"),drawLine(e/2,0,e/2,t/2,n,slw,"round"),drawLine(-e/2,0,-e/2,t/2,n,slw,"round"),drawLine(-e/2,t/2,e/2,t/2,n,slw,"round")}],drawShip=function(e,t,n,a,i,s,l,o){game.fillStyle=l,game.save(),game.beginPath(),game.translate(e+n/2*cs,t+a/2*cs),game.rotate(i+1.5*Math.PI),shapes[s](n*cs,a*cs,o),game.restore()},drawCircle=function(e,t,n,a,i,s){i&&s&&(game.lineWidth=s,game.strokeStyle=i),game.fillStyle=a,game.beginPath(),game.arc(e,t,n,0,2*Math.PI),game.closePath(),game.fill(),i&&s&&game.stroke()},drawLine=function(e,t,n,a,i,s,l){game.lineWidth=s,game.lineCap=l,game.strokeStyle=i,game.beginPath(),game.moveTo(e,t),game.lineTo(n,a),game.stroke(),game.closePath()},drawCurve=function(e,t,n,a,i,s,l,o,r){game.lineWidth=o,game.lineCap=r,game.strokeStyle=l,game.beginPath(),game.moveTo(e,t),game.quadraticCurveTo(i,s,n,a),game.stroke(),game.closePath()},drawRect=function(e,t,n,a,i,s){game.fillStyle=i,game.globalAlpha=s,game.fillRect(e,t,n,a),game.globalAlpha=1},drawText=function(e,t,n,a,i,s){game.fillStyle=s,game.textAlign=n,game.font=t,game.fillText(e,a,i)},drawHealthBar=function(e,t,n,a,i){n*=70,color="#00FF00",30>n&&(color="#FF0000"),drawLine(cx(e)+a/2*cs-n*cs,cy(t)+i*cs+30*cs,cx(e)+a/2*cs+n*cs,cy(t)+i*cs+30*cs,color,1.2*slw,"round")},renderAst=function(e){drawCircle(cx(e.x),cy(e.y),e.r*cs-slw/2,"#999999","#888888",slw),drawHealthBar(e.x-e.r/2,e.y,e.hp,e.r,e.r)},updateLerp=function(e,t){li=lerpxy(e.x,e.y,e.tx,e.ty,t),lhp=lerp(e.hp,e.thp,.2),e.x=li[0],e.y=li[1],e.hp=lhp},updateAlpha=function(e){e.invis?e.alpha-=.1:e.alpha+=.1,e.alpha<0&&(e.alpha=0),e.alpha>1&&(e.alpha=1)},renderPlayer=function(e,t){t?(c=cls,r=rotation,n=name):(c=perm[e.id].cls,r=e.a,n=perm[e.id].name),game.globalAlpha=e.alpha,drawShip(cx(e.x),cy(e.y),classes[c].width,classes[c].height,r,c,classes[c].c1,classes[c].c2),game.globalAlpha=1,e.shield&&(game.globalAlpha=.2,drawCircle(cx(e.x+classes[c].width/2),cy(e.y+classes[c].height/2),classes[c].height+slw,"#000000"),game.globalAlpha=1),e!=player&&(game.globalAlpha=e.alpha),drawHealthBar(e.x,e.y,e.hp,classes[c].width,classes[c].height),drawText(n,"bold "+20*cs+"px Arial","center",cx(e.x)+classes[c].width/2*cs,cy(e.y)+classes[c].height*cs+60*cs,"#000000"),game.globalAlpha=1},findById=function(e,t){return e.indexOf(e.find(function(e){return e.id==t}))},notify=function(e){bigNotification.innerHTML=e,bigNotification.style.bottom="0px",setTimeout(function(){bigNotification.style.bottom="-"+200*cs+"px"},2e3)},dev=function(e){hudElement.innerHTML+='<input type="text" id="dev" style="position:fixed;top:100px;">',devElement=document.getElementById("dev"),devElement.onkeyup=function(e){13==e.keyCode&&(socket.emit("dev",devElement.value),devElement.value="")}},renderBullet=function(e){game.globalAlpha=e.alpha,drawCircle(cx(e.x),cy(e.y),e.r*cs,classes[e.cls].c1,classes[e.cls].c2,slw),game.globalAlpha=1},updateBullet=function(e){m=(Date.now()-e.lastUpdate)/5,dfp(e.ox,e.oy,e.x,e.y)>e.range&&(e.dying=1),point=pfa(e.x,e.y,e.angle,e.speed*m),e.x=point[0],e.y=point[1],f=0,e.x<0&&(e.x=0,f=1),e.x>ww&&(e.x=ww,f=1),e.y<0&&(e.y=0,f=2),e.y>wh&&(e.y=wh,f=2),f>0&&(1==f?e.angle=Math.PI-e.angle:e.angle=0-e.angle),e.dying&&(e.alpha-=.2,e.alpha<0&&bullets.splice(bullets.indexOf(e),1)),e.lastUpdate=Date.now()},background=function(){for(tx=(cpx/gridWidth-Math.floor(cpx/gridWidth))*gridWidth*cs,ty=(cpy/gridWidth-Math.floor(cpy/gridWidth))*gridWidth*cs,ox=cpx,oy=cpy,i=0;i<w/gridWidth/cs+2;i++)drawLine(cx(i*gridWidth+ox)-tx-w/2,0,cx(i*gridWidth+ox)-tx-w/2,h,"#d9d9d9",1*cs,"butt");for(i=0;i<h/gridWidth/cs+2;i++)drawLine(0,cy(i*gridWidth+oy)-ty-h/2,w,cy(i*gridWidth+oy)-ty-h/2,"#d9d9d9",1*cs,"butt");drawRect(cx(-w),cy(0),w*cs,wh*cs,"#000000",.2),drawRect(cx(ww),cy(0),w*cs,wh*cs,"#000000",.2),drawRect(cx(-w),cy(-h),(ww+2*w)*cs,h*cs,"#000000",.2),drawRect(cx(-w),cy(wh),(ww+2*w)*cs,h*cs,"#000000",.2)},updateMyShip=function(){for(name=aliasBox.value,cls="-1"==classBox.value?0:Number(classBox.value),ability="-1"==abilityBox.value?0:Number(abilityBox.value),""==name?myShipHeading.innerHTML="My Ship":myShipHeading.innerHTML=tsc(name)+"'s Ship",myShipClass.innerHTML=menuClasses[cls].name,html="<table>",i=0;i<menuClasses[cls].stats.length;i++)html+='<tr><td style="width:1%"><b>'+menuClassesStats[i]+'</b></td><td><div class="msbar" style="width:'+20*menuClasses[cls].stats[i]+'%"></div></td></tr>';html+="</table>",myShipStats.innerHTML=html,myShipAbility.innerHTML=abilityNames[ability]},updatePoints=function(){pointsBox.innerHTML="Score: "+player.score,noun="points",1==player.points&&(noun="point"),document.getElementById("upoints").innerHTML=player.points+' <span style="font-weight:500">'+noun+"</span>"},updateUpgrades=function(){for(j=0;j<upgrades.length;j++)p=upgrades[j].level*upgradeMult-upgradeMult,document.getElementById("ub"+j).style.width=p+"%",upgrades[j].level*upgradeMult>player.points&&upgrades[j].level<11?document.getElementById("uc"+j).style.color="#FF0000":document.getElementById("uc"+j).style.color="#FFFFFF"},upgradeClick=function(e){id=e.target.parentNode.getAttribute("id"),id&&2==id.length&&(id=Number(id.substr(1,1)),upgrades[id].level*upgradeMult<=player.points&&upgrades[id].level<11&&(socket.emit("upgrade",id),player.points-=upgrades[id].level*upgradeMult,upgrades[id].level++,upgrades[id].level>10?document.getElementById("uc"+id).innerHTML="max":document.getElementById("uc"+id).innerHTML=upgrades[id].level*upgradeMult,updateUpgrades(),updatePoints()))},setupUpgrades=function(){for(upgradesContainer.innerHTML='<div class="upgrade round" style="height:39px;cursor:default;"><div id="uheading" class="baloo">Upgrades</div><div id="upoints">10</div></div>',i=0;i<upgrades.length;i++)upgradesContainer.innerHTML+='<div class="upgrade round" id="u'+i+'"><div class="uinner">'+upgrades[i].name+'</div><div id="uc'+i+'"class="ucost">'+upgradeMult+'</div><div class="ubar round" id="ub'+i+'"></div></div>',upgradeElements.push(document.getElementById("u"+i)),upgradesContainer.onclick=upgradeClick;updateUpgrades()},setupNetwork=function(){socket.on("ready",function(e,t,n){e?(spectating=1,pointsBox.style.display="none",abilityStatus.style.display="none",upgradesContainer.style.display="none",escTip.style.display="block"):(ready=1,name=t,player.points=n,abilityNameElement.innerHTML=abilityNames[ability],setupUpgrades(),updatePoints(),pointsBox.style.display="block",abilityStatus.style.display="block",upgradesContainer.style.display="block",escTip.style.display="none"),blocker&&(abilityStatus.style.display="none"),menuElement.style.opacity="0",menuElement.style.transform="scale(1.5)",setTimeout(function(){menuElement.style.visibility="hidden"},250),hudElement.style.opacity="1"});var e=function(e,t){if(ready=0,auto=0,menuElement.style.visibility="visible",menuElement.style.opacity="1",menuElement.style.transform="scale(1)",hudElement.style.opacity="0",spectating=0,!t){for(e?statsHeading.innerHTML="Disconnected":statsHeading.innerHTML="Game over",mainContainer.style.display="none",i=0;i<otherCards.length;i++)otherCards[i].style.display="none";for(statsContainer.style.display="block",statElements[0].innerHTML=player.score,statElements[1].innerHTML=shipsDestroyed,e=new Date(Date.now()-timeStarted),min=String(e.getMinutes()),sec=String(e.getSeconds()),sec.length<2&&(sec="0"+sec),statElements[2].innerHTML=min+":"+sec,statElements[3].innerHTML=topPosition,statsTwitter.setAttribute("href","https://twitter.com/intent/tweet?text=Just%20played%20http%3A%2F%2Ftrigon.io%3A%20survived%20for%20"+e.getMinutes()+"m "+e.getSeconds()+"s%20and%20got%20a%20score%20of%20"+player.score+".%20Can%20you%20beat%20me%3F&original_referer=http://trigon.io/&hashtags=trigonio,ioninja&via=ioninja14"),player.score=0,i=0;i<upgrades.length;i++)upgrades[i].level=1;updateMyShip()}};socket.on("die",e),socket.on("self",function(e){player={id:e.id,x:e.x,y:e.y,tx:e.x,ty:e.y,hp:1,thp:1,alpha:1,points:0,score:0}}),socket.on("player",function(e){perm[e.id]={name:e.name,cls:e.cls}}),socket.on("deleteAsteroid",function(e){}),socket.on("notify",function(e){notify(e)}),socket.on("fire",function(e,t,n,a,i,s,l,o,r){bullets.push({id:t,owner:e,x:n,y:a,ox:n,oy:a,angle:i,speed:s,range:l,lastUpdate:Date.now(),r:o,cls:r,dying:0,alpha:1})}),socket.on("deleteBullet",function(e){for(i in bullets)bullets[i].id==e&&(bullets[i].dying=1)}),socket.on("points",function(e,t,n){d=e-player.points,notify(1==d?"+"+d+" point":"+"+d+" points"),player.points=e,player.score=t,n&&shipsDestroyed++,updatePoints(),updateUpgrades()}),socket.on("board",function(e){for(html="",i=0;i<e.length;i+=3)bold="",pos=Math.floor(i/3)+1,e[i]==player.id&&(topPosition>pos&&(topPosition=pos),bold=' style="font-weight:bold;"'),html+="<tr"+bold+'><td class="bname">'+pos+". "+e[i+1]+'</td><td class="bscore">'+e[i+2]+"</td></tr>";boardElement.innerHTML=html}),socket.on("use",function(e){abilityFill.style.opacity="1",abilityFill.style.transition="height "+e+"ms, opacity 1s",abilityFill.style.height="120px",setTimeout(function(){abilityFill.style.transition="height 0ms, opacity 1s",abilityFill.style.opacity="0",abilityFill.style.height="0px"},e)}),socket.on("shake",function(){}),socket.on("update",function(e,t,n,a){for(serverDelta=Date.now()-serverLast,serverLast=Date.now(),40>serverDelta&&(serverDelta=40),player.tx=e[0],player.ty=e[1],e.length>2&&(player.thp=e[2],player.shield=e[3],player.invis=e[4]),pids=[],i=0;i<t.length;i+=7)pid=findById(players,t[i]),pids.push(t[i]),pid>-1?(players[pid].tx=t[i+1],players[pid].ty=t[i+2],players[pid].a=t[i+3],players[pid].thp=t[i+4],players[pid].shield=t[i+5],players[pid].invis=t[i+6]):players.push({id:t[i],x:t[i+1],tx:t[i+1],y:t[i+2],ty:t[i+2],a:t[i+3],hp:t[i+4],thp:t[i+4],alpha:1,shield:t[i+5],invis:t[i+6]});for(i=0;i<players.length;i++)pids.indexOf(players[i].id)<0&&players.splice(i,1);for(aids=[],i=0;i<n.length;i+=5)aid=findById(ast,n[i]),aids.push(n[i]),aid>-1?(ast[aid].tx=n[i+1],ast[aid].ty=n[i+2],ast[aid].r=n[i+3],ast[aid].thp=n[i+4]):ast.push({id:n[i],x:n[i+1],tx:n[i+1],y:n[i+2],ty:n[i+2],r:n[i+3],hp:n[i+4],thp:n[i+4]});for(i=0;i<ast.length;i++)aids.indexOf(ast[i].id)<0&&ast.splice(i,1);a?(leader.x=a[0],leader.y=a[1]):(leader.x=null,leader.y=null)}),socket.on("message",function(e,t){appendMessage(e,t)}),socket.on("connect",function(){players=[],ast=[],connectingStatus.innerHTML="",connectingStatus.style["margin-bottom"]="0px",serverFound=1,console.log("Connected!"),console.log("Network transport type: "+socket.io.engine.transport.name)}),socket.on("disconnect",function(){connectingStatus.innerHTML="Connecting...",connectingStatus.style["margin-bottom"]="10px",auto=0,ready?e(1,0):spectating&&e(1,1),serverFound=0,chatMessages.innerHTML="",console.log("Disconnected!")})},findServer=function(){for(console.log("Finding a server..."),serverFound=0,i=0;i<servers.length;i++)x=new XMLHttpRequest,x.onreadystatechange=function(){serverFound||4!=this.readyState||200!=this.status||"0"!=x.responseText&&x.responseURL&&(u=x.responseURL.split("/")[2].split(":")[0],serverFound=1,socket=io.connect("http://"+u+":"+x.responseText+"/",{transports:["websocket"],upgrade:!1}),setupNetwork(),serverLast=Date.now(),console.log("Connecting to http://"+u+":"+x.responseText+"/..."))},x.open("GET","http://"+servers[i]+":3000/ping",!0),x.send();setTimeout(serverTimeout,2e3)},serverTimeout=function(){serverFound||findServer()},mouseDown=function(){ready&&!auto&&socket.emit("mousedown",1)},mouseUp=function(){ready&&!auto&&socket.emit("mousedown",0)},mouseMove=function(e){e.touches?(x=e.touches[0].pageX,y=e.touches[0].pageY):(x=e.pageX,y=e.pageY),rotation=afp(player.x-cpx+w/2,player.y-cpy+h/2,x,y),ready&&socket.emit("mousemove",rotation)};canvas.onmousedown=mouseDown,canvas.onmouseup=mouseUp,document.onmousemove=mouseMove,window.addEventListener("touchstart",mouseDown,!1),window.addEventListener("touchend",mouseUp,!1),window.addEventListener("touchcancel",mouseUp,!1),window.addEventListener("touchmove",mouseMove,!1),aliasBox.onchange=updateMyShip,classBox.onchange=updateMyShip,abilityBox.onchange=updateMyShip,document.onkeydown=function(e){ready&&32==e.keyCode&&(spaceJustDown||(socket.emit("spacedown",1),spaceJustDown=1))},document.onkeyup=function(e){ready?chatInput!=document.activeElement&&(32==e.keyCode?(socket.emit("spacedown",0),spaceJustDown=0):69==e.keyCode&&(auto?(auto=0,socket.emit("mousedown",0)):(auto=1,socket.emit("mousedown",1)))):spectating&&27==e.keyCode&&exit(),13==e.keyCode&&(justSent?justSent=0:chatInput.focus())};var play=function(){socket&&(loadingText.style.display="none",cls="-1"==classBox.value?0:Number(classBox.value),ability="-1"==abilityBox.value?0:Number(abilityBox.value),localStorage.alias=aliasBox.value,localStorage.cls=classBox.value,localStorage.ability=ability,timeStarted=Date.now(),shipsDestroyed=0,topPosition=10,5==cls&&(upgradeMult=8),socket.emit("ready",aliasBox.value,cls,ability,blocker))},spectate=function(){socket&&socket.emit("spectate")},exit=function(){socket&&spectating&&(spectating=0,socket.emit("exit"))};playButton.onclick=play,aliasBox.onkeyup=function(e){13==e.keyCode&&play()},spectateButton.onclick=spectate,logoElement.onclick=function(){profilesElement.style["pointer-events"]="none"==profilesElement.style["pointer-events"]?"auto":"none",profilesElement.style["margin-top"]="-80px"==profilesElement.style["margin-top"]?"-40px":"-80px",profilesElement.style["margin-bottom"]="0px"==profilesElement.style["margin-bottom"]?"30px":"0px",profilesElement.style.opacity="0"==profilesElement.style.opacity?"1":"0"},continueButton.onclick=function(){for(statsContainer.style.display="none",mainContainer.style.display="block",i=0;i<otherCards.length;i++)otherCards[i].style.display="block"};var appendMessage=function(e,t){br="<br>",0==chatMessages.innerHTML.length&&(br=""),chatMessages.innerHTML+=br+'<span style="opacity:0.5;">'+htmlEncode(e)+"</span>  "+htmlEncode(t)};chatInput.onkeyup=function(e){13==e.keyCode&&(m=chatInput.value,/\S/.test(m)&&(socket.emit("send",m),chatInput.value="",chatInput.blur(),justSent=1,chatMessages.scrollTop=chatMessages.scrollHeight))};var update=function(){for(game.fillStyle="#FFFFFF",game.fillRect(0,0,w,h),cd=Date.now()-clientLast,cd>15&&(cd=15),csr=cd/serverDelta,updateCamera(.2),shaking&&updateShake(),background(),i=0;i<ast.length;i++)updateLerp(ast[i],csr),renderAst(ast[i]);for(i=0;i<bullets.length;i++)updateBullet(bullets[i]);for(i=0;i<bullets.length;i++)renderBullet(bullets[i]);for(i=0;i<players.length;i++)updateLerp(players[i],csr),updateAlpha(players[i]),renderPlayer(players[i],0);(ready||spectating)&&(updateLerp(player,csr),updateAlpha(player)),ready&&(lr=rotation,rotation=afp(player.x-cpx+w/2,player.y-cpy+h/2,x,y),rotation!=lr&&socket.emit("mousemove",rotation),renderPlayer(player,1)),clientLast=Date.now(),(ready||spectating)&&(mini.clearRect(0,0,100,100),spectating||(mini.fillStyle="#FFFFFF",mini.beginPath(),mini.arc(player.x/ww*(mms-6)+3,player.y/wh*(mms-6)+3,3,0,2*Math.PI),mini.closePath(),mini.fill()),leader.x&&(mini.fillStyle="#FF0000",mini.beginPath(),mini.arc(leader.x/ww*(mms-6)+3,leader.y/wh*(mms-6)+3,3,0,2*Math.PI),mini.closePath(),mini.fill())),frame(update)},frame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame;for(update(),findServer(),localStorage.alias?(name=localStorage.alias,cls=localStorage.cls,ability=localStorage.ability,aliasBox.value=name,classBox.value=cls,abilityBox.value=ability,"1"==localStorage.unlocked&&unlockClass(0)):(name="",cls=0,ability=0,localStorage.alias="",localStorage.cls="0",localStorage.ability="0",localStorage.unlocked="0"),updateMyShip(),i=0;i<shareButtons.length;i++)shareButtons[i].onclick=function(){unlockClass(1)};aliasBox.focus(),window.onload=function(){loadingText.style.opacity="0",menuElement.style.visibility="visible",menuElement.style.opacity="1",menuElement.style.transform="scale(1)"};